<!DOCTYPE html>
<html>
	<head>
		<title>Blogi testimine</title>
		<meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="css/blog.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<script>
			$(document).ready(function(){
				getPosts();
			});
			
			// Võtab andmebaasist olemasolevad postitused.
			function getPosts() {					
				$.ajax({
					url: "php/getposts.php",
					success: function(data) {
						handleData(data);
					}
				});
			}
			
			// Tegeleb saadud andmetega edasi 
			function handleData(data) {
				var results = jQuery.parseJSON(data);
				for (var i = results.length - 1; i >= 0; i--){
					$("#main").append("<div class='post' id='"+results[i].post_ID+"'></div>");
					$("#"+results[i].post_ID).append("<img src='"+results[i].img+"' height='300'>");
					$("#"+results[i].post_ID).append("<h1>"+results[i].pealkiri+"</h1>");
					// Lisab click eventi, mille abil edastatakse id, et kuvada kogu postitust.
					$("#"+results[i].post_ID).bind("click", "div", function(e) {
						var target = $(e.target);
						if (target.is("img") || target.is("h1")) {
							window.location = "view.php?id=" + target.parent().attr("id") ;
						} else {
							window.location = "view.php?id=" + target.attr("id");
						}
					});
					
				}
			}
		</script>
	</head>
	
	<body>
		<!-- Siia lisatakse olemasolevad postitused -->
		<div id="main"></div>
	</body>
</html>