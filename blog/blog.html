<!DOCTYPE html>
<html>
	<head>
		<title>Blogi testimine</title>
		<meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="css/blog.css">
		<link type="text/css" rel="stylesheet" href="css/simplePagination.css"/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<script type="text/javascript" src="js/jquery.simplePagination.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
		<script>
			var maxPosts;
			var pageNr = 1;
		
			$(document).ready(function(){
				getPosts(pageNr);
				getMaxPosts();
			});
			
			function paginationSetup() {
				$(".pagerr").pagination({
					items: 6,
					itemsOnPage: 5,
					cssStyle: 'dark-theme',
					edges: 1,
					onInit: function() {
						$(".pagerr").pagination("updateItems", maxPosts);
					},
					onPageClick: function(pageNumber) {
						// Kole lahendus
						pageNr = pageNumber;
						$("#main").empty();
						getPosts(pageNr);
					}
				});
			};
			
			// VÃµtab andmebaasist olemasolevad postitused.
			function getPosts(_pageNr) {	
				$.ajax({
					type: "POST",
					url: "php/getposts.php",
					data:{"pagenr": _pageNr},
					success: function(data) {
						handleData(data);
					}
				});
			}
			
			function getMaxPosts() {
				$.ajax({
					url: "php/getPostTotal.php",
					success: function(data) {
						maxPosts = data;
						paginationSetup();
					}
				});
			}
			
			// Tegeleb saadud andmetega edasi 
			function handleData(data) {
				var results = jQuery.parseJSON(data);
				for (var i = results.length - 1; i >= 0; i--){
					$("#main").append("<div class='post' id='"+results[i].post_ID+"'></div>");
					$("#"+results[i].post_ID).append("<img src='"+results[i].img+"' height='300'>");
					$("#"+results[i].post_ID).append("<h1>"+results[i].pealkiri+"</h1>");
					// Lisab click eventi, mille abil edastatakse id, et kuvada kogu postitust.
					$("#"+results[i].post_ID).bind("click", "div", function(e) {
						var target = $(e.target);
						if (target.is("img") || target.is("h1")) {
							window.location = "view.php?id=" + target.parent().attr("id") ;
						} else {
							window.location = "view.php?id=" + target.attr("id");
						}
					});
				}
			}
		</script>
	</head>
	
	<body>
	<nav class="navbar navbar-inverse">
	<div class="navbar-header">
	<p><a href="blog.html"><img src="../img/relatedposts/manna.png" width="50px" height="50px"></a><span style="color: white;" class="MVD"> Manna Va Doosa blogi</span></p>
	</div>
	<p align="right" style="margin-right: 40px; margin-top: 15px;"class="menu-item"><a href="../" class="btn btn-restoran">Tagasi</a></p>
	</nav>
	<br><br><br>
		<!-- Lehtede kuvamiseks. Igal lehel on teatud hulk postitusi -->
		<div class="col-md-8 col-md-offset-2" align="center">
		<div id="pager" class="pagerr">

		</div>
		<!-- Siia lisatakse olemasolevad postitused -->
		<div id="main"></div>
		
		<div class="pagerr">

		</div>
		</div>
	</body>
</html>